<html>
<head>
    <title>Graphiques</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script><!--Pour l'utilisation de Charts.js-->
    <script src="https://www.chartjs.org/samples/latest/utils.js"></script><!--Utilitaire pour les couleurs etc...-->
    <link rel="stylesheet" type="text/css" href="style/styleV2.css" />
</head>
	<body>
        <div id="site">
            <div id="banner1">
                <img class="image_Logo" src="img/logo" />
            </div>
            <nav>
                <ul>
                    <li class="menu-accueil"><a href="index.html">Accueil</a></li>
                    <li class="menu-graphiques">
                        <a href"#">Graphiques</a>
                        <ul class="submenu">
                            <li><a href="graphiques-sol.html">Production Solaire</a></li>
                            <li><a href="graphiques-eol.html">Production Eolienne</a></li>
                            <li><a href="graphiques-tem.html">Consommation Température</a></li>
                        </ul>
                    </li>
                    <li class="menu-stats">
                        <a href"#">Stats</a>
                        <ul class="submenu">
                            <li><a href="stats-extremes.html">Les extremes</a></li>
                            <li><a href="top-region.html">Le Top des regions Vertes</a></li>
                        </ul>
                    </li>
                    <li class="menu-synthese"><a href="synthese.html">Synthese</a></li>
                </ul>
            </nav><!--Gestion du menu-->

            <div id="contenuprincipal">
                <canvas id="myChart"></canvas><!--appel du graphique, configuré et geré dans la partie script-->
                <p style="font-size:large; text-align:justify; font-style:italic">
                    Cette courbe nous montre le lien existant entre la consommation electrique instantannée en GW avec la température en france métropolitaine.
                    Ces données issues d'un jeu traitant le mois de juillet 2019 nous permet de visualiser la tendance des deux courbes qui est relativement proche.
                    Deux chose a constater sur ce graphique, la premiere concerne une nette accroissement de la consommation une fois passé une certain seuil de température (utilisation de la climatisation)
                    De plus on remarque une baisse franche de la consommation a des dates bien précise, ces dates sont les différents dimanche du mois, jours ou la majeur partie de l'activité insdustriel et economique est a l'arret ce qui explique ces baisses localisées.
                </p>
            </div><!--Contenu principal de la fenetre-->

            <script>
                var ajax = new XMLHttpRequest();
                var ajax2 = new XMLHttpRequest();
                var ajax3 = new XMLHttpRequest();// les 3 variables de requetes
                var donnees;
                var donnees2;
                var donnees3;// les 3 variables intermédiare pour le passage en JSON
                var datatab = new Array();
                var datatab2 = new Array();
                var datatab3 = new Array();// les 3 tableaux qui seront utilisés comme donnée du graphique

                ajax2.open("Get", "Horodate.php", true);// appel de Horodate.php qui contient la requete SQL qui renvois les jours concernés
                ajax2.send();
                ajax3.open("Get", "Consommation.php", true);// appel de Consommation.php qui contient la requete SQL qui renvois les valeurs de la conso electrique
                ajax3.send();
                ajax.open("Get", "Temperature.php", true);// appel de temperature.php qui contient la requete SQL qui renvois les valeurs de la temperature
                ajax.send();

                ajax.onreadystatechange = function () {//Si une données de la base de données change ou qu'un appel de donées est fait alors les données se mettent a jours
                    if (ajax.readyState == 4 && ajax.status == 200) {
                        donnees = JSON.parse(ajax.responseText);//passage du resultat de la requete en tableau format JSON
                        for (var a = 0; a < donnees.length; a++) {
                            datatab[a] = donnees[a].Temperature_realisee_lissee;//Passage en un tableau d'entier 
                        }

                        donnees2 = JSON.parse(ajax2.responseText);//passage du resultat de la requete en tableau format JSON
                        for (var b = 0; b < donnees2.length; b++) {
                            datatab2[b] = donnees2[b].Horodate.substring(5, 10);//Passage en un tableau de string avec une troncature pour obtenir la partie intéréssante de la chaine de caractere
                        }

                        donnees3 = JSON.parse(ajax3.responseText);//passage du resultat de la requete en tableau format JSON
                        for (var c = 0; c < donnees3.length; c++) {
                            datatab3[c] = donnees3[c].Consommation_totale_profilee / 100000000;//Passage en un tableau d'entier avec un petit traitement pour passage de W a GW
                        }


                        var lineChartData = {//création d'une variable contenant les données de notre graphique
                            labels: datatab2,//les données en abscisse seront le resultat de la requete ajax2 post traitement
                            datasets: [{
                                label: 'Température',
                                borderColor: window.chartColors.red,
                                backgroundColor: window.chartColors.red,
                                fill: false,
                                data: datatab,//les données en abscisse seront le resultat de la requete ajax post traitement
                                yAxisID: 'y-axis-1',
                            }, {
                                label: 'Consommation (GW)',
                                borderColor: window.chartColors.blue,
                                backgroundColor: window.chartColors.blue,
                                fill: false,
                                data: datatab3,//les données en abscisse seront le resultat de la requete ajax3 post traitement
                                yAxisID: 'y-axis-2'
                            }]
                        };

                        var ctx = document.getElementById('myChart').getContext('2d');//création d'une variable contenant l'objet graphique que l'ont va afficher dans canvas et alimenter par les données de lineChartData
                        window.myLine = Chart.Line(ctx, {
                            data: lineChartData,
                            options: {
                                responsive: true,
                                hoverMode: 'index',
                                stacked: false,
                                title: {
                                    display: true,
                                    text: 'Corrélation Consommation - Température'
                                },
                                scales: {
                                    yAxes: [{
                                        type: 'linear',
                                        display: true,
                                        position: 'left',
                                        id: 'y-axis-1',
                                    }, {
                                        type: 'linear',
                                        display: true,
                                        position: 'right',
                                        id: 'y-axis-2',

                                        gridLines: {
                                            drawOnChartArea: false,
                                        },
                                    }],
                                }
                            }
                        });
                    }
                }
            </script>

            <div id="footer">
                <p>Emna Blaiech - Camille Chatelet - Guillaumme Foucourt | Tous droits réservés</p>
            </div>
        </div>
	</body>
</html>